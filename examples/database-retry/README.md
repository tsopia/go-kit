# Database è¿æ¥é‡è¯•æœºåˆ¶æ¼”ç¤º

è¿™ä¸ªç¤ºä¾‹æ¼”ç¤ºäº† go-kit æ•°æ®åº“åŒ…çš„è¿æ¥é‡è¯•æœºåˆ¶åŠŸèƒ½ã€‚

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### æ™ºèƒ½é‡è¯•ç­–ç•¥
- **æŒ‡æ•°é€€é¿**: æ¯æ¬¡é‡è¯•çš„å»¶è¿Ÿæ—¶é—´å‘ˆæŒ‡æ•°å¢é•¿
- **æœ€å¤§å»¶è¿Ÿé™åˆ¶**: é˜²æ­¢é‡è¯•é—´éš”è¿‡é•¿
- **æŠ–åŠ¨æœºåˆ¶**: é¿å…é›·ç¾¤æ•ˆåº”ï¼Œåˆ†æ•£é‡è¯•æ—¶é—´
- **å¯é…ç½®é‡è¯•æ¬¡æ•°**: æ”¯æŒ1-100æ¬¡é‡è¯•

### ç”¨æˆ·æ— æ„ŸçŸ¥è®¾è®¡
- **é»˜è®¤å¯ç”¨**: å½“é…ç½®é‡è¯•æ¬¡æ•°>1æ—¶è‡ªåŠ¨å¯ç”¨
- **åˆç†é»˜è®¤å€¼**: æä¾›ç”Ÿäº§ç¯å¢ƒå¯ç”¨çš„é»˜è®¤é…ç½®
- **é€æ˜é‡è¯•**: ç”¨æˆ·æ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç 

## ğŸ“‹ é…ç½®å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `RetryEnabled` | bool | true | æ˜¯å¦å¯ç”¨é‡è¯• |
| `RetryMaxAttempts` | int | 3 | æœ€å¤§é‡è¯•æ¬¡æ•° |
| `RetryInitialDelay` | time.Duration | 1s | åˆå§‹é‡è¯•å»¶è¿Ÿ |
| `RetryMaxDelay` | time.Duration | 30s | æœ€å¤§é‡è¯•å»¶è¿Ÿ |
| `RetryBackoffFactor` | float64 | 2.0 | é€€é¿å› å­ |
| `RetryJitterEnabled` | bool | true | æ˜¯å¦å¯ç”¨æŠ–åŠ¨ |

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### 1. é»˜è®¤é…ç½®ï¼ˆæ¨èï¼‰
```go
config := &database.Config{
    Driver:   "mysql",
    Host:     "localhost",
    Port:     3306,
    Username: "root",
    Password: "password",
    Database: "test",
    // è‡ªåŠ¨ä½¿ç”¨é»˜è®¤é‡è¯•é…ç½®
}
```

### 2. è‡ªå®šä¹‰é‡è¯•ç­–ç•¥
```go
config := &database.Config{
    Driver:   "mysql",
    Host:     "localhost",
    Port:     3306,
    Username: "root",
    Password: "password",
    Database: "test",
    
    // è‡ªå®šä¹‰é‡è¯•ç­–ç•¥
    RetryEnabled:       true,
    RetryMaxAttempts:   5,
    RetryInitialDelay:  500 * time.Millisecond,
    RetryMaxDelay:      10 * time.Second,
    RetryBackoffFactor: 1.5,
    RetryJitterEnabled: true,
}
```

### 3. ç¦ç”¨é‡è¯•
```go
config := &database.Config{
    Driver:   "sqlite",
    Database: ":memory:",
    
    // ç¦ç”¨é‡è¯•
    RetryEnabled:     false,
    RetryMaxAttempts: 1,
}
```

## ğŸ“Š é‡è¯•å»¶è¿Ÿè®¡ç®—

é‡è¯•å»¶è¿Ÿé‡‡ç”¨æŒ‡æ•°é€€é¿ç®—æ³•ï¼š

```
å»¶è¿Ÿ = åˆå§‹å»¶è¿Ÿ Ã— é€€é¿å› å­^(é‡è¯•æ¬¡æ•°-1)
```

ä»¥é»˜è®¤é…ç½®ä¸ºä¾‹ï¼š
- ç¬¬1æ¬¡é‡è¯•: 1s
- ç¬¬2æ¬¡é‡è¯•: 2s  
- ç¬¬3æ¬¡é‡è¯•: 4s
- ç¬¬4æ¬¡é‡è¯•: 8s
- ç¬¬5æ¬¡é‡è¯•: 16s
- ç¬¬6æ¬¡é‡è¯•: 30s (è¾¾åˆ°æœ€å¤§å»¶è¿Ÿ)

## ğŸ”§ è¿è¡Œæ¼”ç¤º

```bash
# è¿è¡Œæ¼”ç¤ºç¨‹åº
go run examples/database-retry/main.go

# è¿è¡Œç›¸å…³æµ‹è¯•
go test ./pkg/database -v -run TestRetry
```

## ğŸ¨ è®¾è®¡ç†å¿µ

1. **ç”¨æˆ·æ— æ„ŸçŸ¥**: ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹å³å¯äº«å—é‡è¯•åŠŸèƒ½
2. **ç”Ÿäº§å°±ç»ª**: æä¾›ç»è¿‡éªŒè¯çš„é»˜è®¤é…ç½®
3. **é«˜åº¦å¯é…ç½®**: æ”¯æŒå„ç§å¤æ‚çš„é‡è¯•åœºæ™¯
4. **æ€§èƒ½ä¼˜åŒ–**: æ™ºèƒ½æŠ–åŠ¨æœºåˆ¶é¿å…ç³»ç»Ÿè¿‡è½½

## ğŸ“ æ³¨æ„äº‹é¡¹

- é‡è¯•æœºåˆ¶ä»…åœ¨åˆå§‹è¿æ¥æ—¶ç”Ÿæ•ˆ
- å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ç”¨é‡è¯•åŠŸèƒ½
- å¯ä»¥é€šè¿‡æ—¥å¿—è§‚å¯Ÿé‡è¯•è¿‡ç¨‹
- é‡è¯•æ¬¡æ•°è¿‡å¤šå¯èƒ½å»¶é•¿å¯åŠ¨æ—¶é—´

## ğŸ¤ é€‚ç”¨åœºæ™¯

- æ•°æ®åº“æœåŠ¡é‡å¯
- ç½‘ç»œä¸ç¨³å®š
- å®¹å™¨åŒ–ç¯å¢ƒå¯åŠ¨é¡ºåºé—®é¢˜
- äº‘æœåŠ¡ä¸´æ—¶ä¸å¯ç”¨
- è´Ÿè½½å‡è¡¡å™¨æ•…éšœè½¬ç§» 